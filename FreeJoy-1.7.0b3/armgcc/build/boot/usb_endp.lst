ARM GAS  /tmp/cc2SP10t.s 			page 1


   1              		.cpu cortex-m3
   2              		.eabi_attribute 20, 1
   3              		.eabi_attribute 21, 1
   4              		.eabi_attribute 23, 3
   5              		.eabi_attribute 24, 1
   6              		.eabi_attribute 25, 1
   7              		.eabi_attribute 26, 1
   8              		.eabi_attribute 30, 4
   9              		.eabi_attribute 34, 1
  10              		.eabi_attribute 18, 4
  11              		.file	"usb_endp.c"
  12              		.text
  13              	.Ltext0:
  14              		.cfi_sections	.debug_frame
  15              		.section	.text.EP1_IN_Callback,"ax",%progbits
  16              		.align	1
  17              		.global	EP1_IN_Callback
  18              		.arch armv7-m
  19              		.syntax unified
  20              		.thumb
  21              		.thumb_func
  22              		.fpu softvfp
  24              	EP1_IN_Callback:
  25              	.LFB30:
  26              		.file 1 "../bootloader/Src/usb_endp.c"
   1:../bootloader/Src/usb_endp.c **** /**
   2:../bootloader/Src/usb_endp.c ****   ******************************************************************************
   3:../bootloader/Src/usb_endp.c ****   * @file    usb_endp.c
   4:../bootloader/Src/usb_endp.c ****   * @author  MCD Application Team
   5:../bootloader/Src/usb_endp.c ****   * @version V4.1.0
   6:../bootloader/Src/usb_endp.c ****   * @date    26-May-2017
   7:../bootloader/Src/usb_endp.c ****   * @brief   Endpoint routines
   8:../bootloader/Src/usb_endp.c ****   ******************************************************************************
   9:../bootloader/Src/usb_endp.c ****   * @attention
  10:../bootloader/Src/usb_endp.c ****   *
  11:../bootloader/Src/usb_endp.c ****   * <h2><center>&copy; COPYRIGHT(c) 2017 STMicroelectronics</center></h2>
  12:../bootloader/Src/usb_endp.c ****   *
  13:../bootloader/Src/usb_endp.c ****   * Redistribution and use in source and binary forms, with or without modification,
  14:../bootloader/Src/usb_endp.c ****   * are permitted provided that the following conditions are met:
  15:../bootloader/Src/usb_endp.c ****   *   1. Redistributions of source code must retain the above copyright notice,
  16:../bootloader/Src/usb_endp.c ****   *      this list of conditions and the following disclaimer.
  17:../bootloader/Src/usb_endp.c ****   *   2. Redistributions in binary form must reproduce the above copyright notice,
  18:../bootloader/Src/usb_endp.c ****   *      this list of conditions and the following disclaimer in the documentation
  19:../bootloader/Src/usb_endp.c ****   *      and/or other materials provided with the distribution.
  20:../bootloader/Src/usb_endp.c ****   *   3. Neither the name of STMicroelectronics nor the names of its contributors
  21:../bootloader/Src/usb_endp.c ****   *      may be used to endorse or promote products derived from this software
  22:../bootloader/Src/usb_endp.c ****   *      without specific prior written permission.
  23:../bootloader/Src/usb_endp.c ****   *
  24:../bootloader/Src/usb_endp.c ****   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  25:../bootloader/Src/usb_endp.c ****   * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  26:../bootloader/Src/usb_endp.c ****   * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
  27:../bootloader/Src/usb_endp.c ****   * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
  28:../bootloader/Src/usb_endp.c ****   * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  29:../bootloader/Src/usb_endp.c ****   * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
  30:../bootloader/Src/usb_endp.c ****   * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
  31:../bootloader/Src/usb_endp.c ****   * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
  32:../bootloader/Src/usb_endp.c ****   * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
ARM GAS  /tmp/cc2SP10t.s 			page 2


  33:../bootloader/Src/usb_endp.c ****   * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  34:../bootloader/Src/usb_endp.c ****   *
  35:../bootloader/Src/usb_endp.c ****   ******************************************************************************
  36:../bootloader/Src/usb_endp.c ****   */
  37:../bootloader/Src/usb_endp.c **** 
  38:../bootloader/Src/usb_endp.c **** 
  39:../bootloader/Src/usb_endp.c **** /* Includes ------------------------------------------------------------------*/
  40:../bootloader/Src/usb_endp.c **** 
  41:../bootloader/Src/usb_endp.c **** #include "periphery.h"
  42:../bootloader/Src/usb_endp.c **** #include "usb_hw.h"
  43:../bootloader/Src/usb_endp.c **** #include "usb_lib.h"
  44:../bootloader/Src/usb_endp.c **** #include "usb_istr.h"
  45:../bootloader/Src/usb_endp.c **** #include "usb_pwr.h"
  46:../bootloader/Src/usb_endp.c **** 
  47:../bootloader/Src/usb_endp.c **** #include "crc16.h"
  48:../bootloader/Src/usb_endp.c **** 
  49:../bootloader/Src/usb_endp.c **** /* Private typedef -----------------------------------------------------------*/
  50:../bootloader/Src/usb_endp.c **** /* Private define ------------------------------------------------------------*/
  51:../bootloader/Src/usb_endp.c **** 
  52:../bootloader/Src/usb_endp.c **** 
  53:../bootloader/Src/usb_endp.c **** 
  54:../bootloader/Src/usb_endp.c **** #define REPORT_ID_FIRMWARE				0x04
  55:../bootloader/Src/usb_endp.c **** 
  56:../bootloader/Src/usb_endp.c **** 
  57:../bootloader/Src/usb_endp.c **** /* Private macro -------------------------------------------------------------*/
  58:../bootloader/Src/usb_endp.c **** /* Private variables ---------------------------------------------------------*/
  59:../bootloader/Src/usb_endp.c **** 
  60:../bootloader/Src/usb_endp.c **** __IO uint8_t EP1_PrevXferComplete = 1;
  61:../bootloader/Src/usb_endp.c **** static volatile uint16_t crc_in = 0;
  62:../bootloader/Src/usb_endp.c **** 
  63:../bootloader/Src/usb_endp.c **** volatile bool flash_started = 0;
  64:../bootloader/Src/usb_endp.c **** volatile bool flash_finished = 0;
  65:../bootloader/Src/usb_endp.c **** 
  66:../bootloader/Src/usb_endp.c **** /* Private function prototypes -----------------------------------------------*/
  67:../bootloader/Src/usb_endp.c **** /* Private functions ---------------------------------------------------------*/
  68:../bootloader/Src/usb_endp.c **** /*******************************************************************************
  69:../bootloader/Src/usb_endp.c **** * Function Name  : EP1_OUT_Callback.
  70:../bootloader/Src/usb_endp.c **** * Description    : EP1 OUT Callback Routine.
  71:../bootloader/Src/usb_endp.c **** * Input          : None.
  72:../bootloader/Src/usb_endp.c **** * Output         : None.
  73:../bootloader/Src/usb_endp.c **** * Return         : None.
  74:../bootloader/Src/usb_endp.c **** *******************************************************************************/
  75:../bootloader/Src/usb_endp.c **** void EP1_OUT_Callback(void)
  76:../bootloader/Src/usb_endp.c **** {
  77:../bootloader/Src/usb_endp.c **** 	static  uint16_t firmware_len = 0;
  78:../bootloader/Src/usb_endp.c **** 
  79:../bootloader/Src/usb_endp.c **** 	uint8_t hid_buf[64];
  80:../bootloader/Src/usb_endp.c **** 	uint8_t repotId;
  81:../bootloader/Src/usb_endp.c **** 	
  82:../bootloader/Src/usb_endp.c **** 	/* Read received data (2 bytes) */  
  83:../bootloader/Src/usb_endp.c ****   USB_SIL_Read(EP1_OUT, hid_buf);
  84:../bootloader/Src/usb_endp.c **** 	
  85:../bootloader/Src/usb_endp.c **** 	repotId = hid_buf[0];
  86:../bootloader/Src/usb_endp.c **** 	
  87:../bootloader/Src/usb_endp.c **** 	LED1_ON;
  88:../bootloader/Src/usb_endp.c **** 	switch (repotId)
  89:../bootloader/Src/usb_endp.c **** 	{		
ARM GAS  /tmp/cc2SP10t.s 			page 3


  90:../bootloader/Src/usb_endp.c **** 		case REPORT_ID_FIRMWARE:
  91:../bootloader/Src/usb_endp.c **** 		{			
  92:../bootloader/Src/usb_endp.c **** 			uint16_t crc_comp = 0;
  93:../bootloader/Src/usb_endp.c **** 			uint16_t firmware_in_cnt = 0;
  94:../bootloader/Src/usb_endp.c **** 			
  95:../bootloader/Src/usb_endp.c **** 			uint16_t cnt = hid_buf[1]<<8 | hid_buf[2];
  96:../bootloader/Src/usb_endp.c **** 			
  97:../bootloader/Src/usb_endp.c **** 			if (cnt == 0)			// first packet with info data
  98:../bootloader/Src/usb_endp.c **** 			{
  99:../bootloader/Src/usb_endp.c **** 				firmware_len = hid_buf[5]<<8 | hid_buf[4];
 100:../bootloader/Src/usb_endp.c **** 				crc_in = hid_buf[7]<<8 | hid_buf[6];
 101:../bootloader/Src/usb_endp.c **** 				
 102:../bootloader/Src/usb_endp.c **** 				if (firmware_len <= 0xE000)	// check new firmware size, 56kB max
 103:../bootloader/Src/usb_endp.c **** 				{
 104:../bootloader/Src/usb_endp.c **** 					flash_started = 1;
 105:../bootloader/Src/usb_endp.c **** 					
 106:../bootloader/Src/usb_endp.c **** 					FLASH_Unlock();
 107:../bootloader/Src/usb_endp.c **** 					for (uint8_t i=0; i<MAX_PAGE-FIRMWARE_START_PAGE; i++)
 108:../bootloader/Src/usb_endp.c **** 					{
 109:../bootloader/Src/usb_endp.c **** 						if (FLASH_ErasePage(FIRMWARE_COPY_ADDR +i*FLASH_PAGE_SIZE) != FLASH_COMPLETE)
 110:../bootloader/Src/usb_endp.c **** 						{
 111:../bootloader/Src/usb_endp.c **** 							firmware_in_cnt = 0xF003;	// flash erase error
 112:../bootloader/Src/usb_endp.c **** 						}							
 113:../bootloader/Src/usb_endp.c **** 					}
 114:../bootloader/Src/usb_endp.c **** 					FLASH_Lock();
 115:../bootloader/Src/usb_endp.c **** 					firmware_in_cnt = cnt+1;
 116:../bootloader/Src/usb_endp.c **** 				}
 117:../bootloader/Src/usb_endp.c **** 				else // firmware size error
 118:../bootloader/Src/usb_endp.c **** 				{
 119:../bootloader/Src/usb_endp.c **** 					firmware_in_cnt = 0xF001;
 120:../bootloader/Src/usb_endp.c **** 				}
 121:../bootloader/Src/usb_endp.c **** 			}
 122:../bootloader/Src/usb_endp.c **** 			else if (flash_started && (firmware_len > 0) && (cnt*60 < firmware_len) )		// body of firmware d
 123:../bootloader/Src/usb_endp.c **** 			{
 124:../bootloader/Src/usb_endp.c **** 				FLASH_Unlock();
 125:../bootloader/Src/usb_endp.c **** 				for (uint8_t i=0;i<60;i+=2)
 126:../bootloader/Src/usb_endp.c **** 				{
 127:../bootloader/Src/usb_endp.c **** 					uint16_t tmp16 = hid_buf[i + 5]<<8 | hid_buf[i + 4];
 128:../bootloader/Src/usb_endp.c **** 					FLASH_ProgramHalfWord(FIRMWARE_COPY_ADDR + (cnt-1)*60 + i, tmp16);
 129:../bootloader/Src/usb_endp.c **** 				}
 130:../bootloader/Src/usb_endp.c **** 				FLASH_Lock();
 131:../bootloader/Src/usb_endp.c **** 				firmware_in_cnt = cnt+1;
 132:../bootloader/Src/usb_endp.c **** 			}
 133:../bootloader/Src/usb_endp.c **** 			else if (flash_started && firmware_len > 0)		// last packet
 134:../bootloader/Src/usb_endp.c **** 			{
 135:../bootloader/Src/usb_endp.c **** 				FLASH_Unlock();
 136:../bootloader/Src/usb_endp.c **** 				for (uint8_t i=0;i<60;i+=2)
 137:../bootloader/Src/usb_endp.c **** 				{
 138:../bootloader/Src/usb_endp.c **** 					uint16_t tmp16 = hid_buf[i + 5]<<8 | hid_buf[i + 4];
 139:../bootloader/Src/usb_endp.c **** 					FLASH_ProgramHalfWord(FIRMWARE_COPY_ADDR + (cnt-1)*60 + i, tmp16);
 140:../bootloader/Src/usb_endp.c **** 				}
 141:../bootloader/Src/usb_endp.c **** 				FLASH_Lock();
 142:../bootloader/Src/usb_endp.c **** 				
 143:../bootloader/Src/usb_endp.c **** 				// check CRC16				
 144:../bootloader/Src/usb_endp.c **** 				crc_comp = Crc16((uint8_t*)FIRMWARE_COPY_ADDR, firmware_len);				
 145:../bootloader/Src/usb_endp.c **** 				if (crc_in == crc_comp && crc_comp != 0)
 146:../bootloader/Src/usb_endp.c **** 				{
ARM GAS  /tmp/cc2SP10t.s 			page 4


 147:../bootloader/Src/usb_endp.c **** 					flash_started = 0;
 148:../bootloader/Src/usb_endp.c **** 					flash_finished = 1;
 149:../bootloader/Src/usb_endp.c **** 					firmware_in_cnt = 0xF000;	// OK
 150:../bootloader/Src/usb_endp.c **** 				}
 151:../bootloader/Src/usb_endp.c **** 				else	// CRC error
 152:../bootloader/Src/usb_endp.c **** 				{
 153:../bootloader/Src/usb_endp.c **** 					firmware_in_cnt = 0xF002;
 154:../bootloader/Src/usb_endp.c **** 				}
 155:../bootloader/Src/usb_endp.c **** 			}
 156:../bootloader/Src/usb_endp.c **** 			
 157:../bootloader/Src/usb_endp.c **** 			if (firmware_in_cnt > 0)
 158:../bootloader/Src/usb_endp.c **** 			{
 159:../bootloader/Src/usb_endp.c **** 				uint8_t tmp_buf[3];
 160:../bootloader/Src/usb_endp.c **** 				tmp_buf[0] = REPORT_ID_FIRMWARE;
 161:../bootloader/Src/usb_endp.c **** 				tmp_buf[1] = (firmware_in_cnt)>>8;
 162:../bootloader/Src/usb_endp.c **** 				tmp_buf[2] = (firmware_in_cnt)&0xFF;
 163:../bootloader/Src/usb_endp.c **** 				
 164:../bootloader/Src/usb_endp.c **** 				USB_CUSTOM_HID_SendReport(1, tmp_buf, 3);
 165:../bootloader/Src/usb_endp.c **** 
 166:../bootloader/Src/usb_endp.c **** 			}
 167:../bootloader/Src/usb_endp.c **** 			
 168:../bootloader/Src/usb_endp.c **** 		}
 169:../bootloader/Src/usb_endp.c **** 		break;
 170:../bootloader/Src/usb_endp.c **** 		
 171:../bootloader/Src/usb_endp.c **** 		default:
 172:../bootloader/Src/usb_endp.c **** 			break;
 173:../bootloader/Src/usb_endp.c **** 	}
 174:../bootloader/Src/usb_endp.c **** 	
 175:../bootloader/Src/usb_endp.c **** 	LED1_OFF;	
 176:../bootloader/Src/usb_endp.c ****   SetEPRxStatus(ENDP1, EP_RX_VALID);
 177:../bootloader/Src/usb_endp.c **** }
 178:../bootloader/Src/usb_endp.c **** 
 179:../bootloader/Src/usb_endp.c **** /*******************************************************************************
 180:../bootloader/Src/usb_endp.c **** * Function Name  : EP1_IN_Callback.
 181:../bootloader/Src/usb_endp.c **** * Description    : EP1 IN Callback Routine.
 182:../bootloader/Src/usb_endp.c **** * Input          : None.
 183:../bootloader/Src/usb_endp.c **** * Output         : None.
 184:../bootloader/Src/usb_endp.c **** * Return         : None.
 185:../bootloader/Src/usb_endp.c **** *******************************************************************************/
 186:../bootloader/Src/usb_endp.c **** void EP1_IN_Callback(void)
 187:../bootloader/Src/usb_endp.c **** {
  27              		.loc 1 187 1 view -0
  28              		.cfi_startproc
  29              		@ args = 0, pretend = 0, frame = 0
  30              		@ frame_needed = 0, uses_anonymous_args = 0
  31              		@ link register save eliminated.
 188:../bootloader/Src/usb_endp.c ****   EP1_PrevXferComplete = 1;
  32              		.loc 1 188 3 view .LVU1
  33              		.loc 1 188 24 is_stmt 0 view .LVU2
  34 0000 0122     		movs	r2, #1
  35 0002 014B     		ldr	r3, .L2
  36 0004 1A70     		strb	r2, [r3]
 189:../bootloader/Src/usb_endp.c **** }
  37              		.loc 1 189 1 view .LVU3
  38 0006 7047     		bx	lr
  39              	.L3:
  40              		.align	2
ARM GAS  /tmp/cc2SP10t.s 			page 5


  41              	.L2:
  42 0008 00000000 		.word	.LANCHOR0
  43              		.cfi_endproc
  44              	.LFE30:
  46              		.section	.text.USB_CUSTOM_HID_SendReport,"ax",%progbits
  47              		.align	1
  48              		.global	USB_CUSTOM_HID_SendReport
  49              		.syntax unified
  50              		.thumb
  51              		.thumb_func
  52              		.fpu softvfp
  54              	USB_CUSTOM_HID_SendReport:
  55              	.LVL0:
  56              	.LFB31:
 190:../bootloader/Src/usb_endp.c **** 
 191:../bootloader/Src/usb_endp.c **** int8_t USB_CUSTOM_HID_SendReport(uint8_t EP_num, uint8_t * data, uint8_t length)
 192:../bootloader/Src/usb_endp.c **** {
  57              		.loc 1 192 1 is_stmt 1 view -0
  58              		.cfi_startproc
  59              		@ args = 0, pretend = 0, frame = 0
  60              		@ frame_needed = 0, uses_anonymous_args = 0
 193:../bootloader/Src/usb_endp.c **** 	if ((EP1_PrevXferComplete) && (bDeviceState == CONFIGURED))
  61              		.loc 1 193 2 view .LVU5
 192:../bootloader/Src/usb_endp.c **** 	if ((EP1_PrevXferComplete) && (bDeviceState == CONFIGURED))
  62              		.loc 1 192 1 is_stmt 0 view .LVU6
  63 0000 10B5     		push	{r4, lr}
  64              	.LCFI0:
  65              		.cfi_def_cfa_offset 8
  66              		.cfi_offset 4, -8
  67              		.cfi_offset 14, -4
  68              		.loc 1 193 6 view .LVU7
  69 0002 094C     		ldr	r4, .L8
  70 0004 2378     		ldrb	r3, [r4]	@ zero_extendqisi2
  71              		.loc 1 193 5 view .LVU8
  72 0006 63B1     		cbz	r3, .L7
  73              		.loc 1 193 46 discriminator 1 view .LVU9
  74 0008 084B     		ldr	r3, .L8+4
  75 000a 1B68     		ldr	r3, [r3]
  76              		.loc 1 193 29 discriminator 1 view .LVU10
  77 000c 052B     		cmp	r3, #5
  78 000e 08D1     		bne	.L7
 194:../bootloader/Src/usb_endp.c **** 	{
 195:../bootloader/Src/usb_endp.c **** 			USB_SIL_Write(EP1_IN, data, length);
  79              		.loc 1 195 4 is_stmt 1 view .LVU11
  80 0010 8120     		movs	r0, #129
  81              	.LVL1:
  82              		.loc 1 195 4 is_stmt 0 view .LVU12
  83 0012 FFF7FEFF 		bl	USB_SIL_Write
  84              	.LVL2:
 196:../bootloader/Src/usb_endp.c **** 			SetEPTxValid(ENDP1);
  85              		.loc 1 196 4 is_stmt 1 view .LVU13
  86 0016 0120     		movs	r0, #1
  87 0018 FFF7FEFF 		bl	SetEPTxValid
  88              	.LVL3:
 197:../bootloader/Src/usb_endp.c **** 			EP1_PrevXferComplete = 0;
  89              		.loc 1 197 4 view .LVU14
  90              		.loc 1 197 25 is_stmt 0 view .LVU15
ARM GAS  /tmp/cc2SP10t.s 			page 6


  91 001c 0020     		movs	r0, #0
  92 001e 2070     		strb	r0, [r4]
 198:../bootloader/Src/usb_endp.c **** 			return 0;
  93              		.loc 1 198 4 is_stmt 1 view .LVU16
  94              	.L5:
 199:../bootloader/Src/usb_endp.c **** 	}
 200:../bootloader/Src/usb_endp.c **** 	return -1;
 201:../bootloader/Src/usb_endp.c **** }
  95              		.loc 1 201 1 is_stmt 0 view .LVU17
  96 0020 10BD     		pop	{r4, pc}
  97              	.LVL4:
  98              	.L7:
 200:../bootloader/Src/usb_endp.c **** }
  99              		.loc 1 200 9 view .LVU18
 100 0022 4FF0FF30 		mov	r0, #-1
 101              	.LVL5:
 200:../bootloader/Src/usb_endp.c **** }
 102              		.loc 1 200 9 view .LVU19
 103 0026 FBE7     		b	.L5
 104              	.L9:
 105              		.align	2
 106              	.L8:
 107 0028 00000000 		.word	.LANCHOR0
 108 002c 00000000 		.word	bDeviceState
 109              		.cfi_endproc
 110              	.LFE31:
 112              		.section	.text.EP1_OUT_Callback,"ax",%progbits
 113              		.align	1
 114              		.global	EP1_OUT_Callback
 115              		.syntax unified
 116              		.thumb
 117              		.thumb_func
 118              		.fpu softvfp
 120              	EP1_OUT_Callback:
 121              	.LFB29:
  76:../bootloader/Src/usb_endp.c **** 	static  uint16_t firmware_len = 0;
 122              		.loc 1 76 1 is_stmt 1 view -0
 123              		.cfi_startproc
 124              		@ args = 0, pretend = 0, frame = 72
 125              		@ frame_needed = 0, uses_anonymous_args = 0
  77:../bootloader/Src/usb_endp.c **** 
 126              		.loc 1 77 2 view .LVU21
  79:../bootloader/Src/usb_endp.c **** 	uint8_t repotId;
 127              		.loc 1 79 2 view .LVU22
  80:../bootloader/Src/usb_endp.c **** 	
 128              		.loc 1 80 2 view .LVU23
  83:../bootloader/Src/usb_endp.c **** 	
 129              		.loc 1 83 3 view .LVU24
  76:../bootloader/Src/usb_endp.c **** 	static  uint16_t firmware_len = 0;
 130              		.loc 1 76 1 is_stmt 0 view .LVU25
 131 0000 2DE9F047 		push	{r4, r5, r6, r7, r8, r9, r10, lr}
 132              	.LCFI1:
 133              		.cfi_def_cfa_offset 32
 134              		.cfi_offset 4, -32
 135              		.cfi_offset 5, -28
 136              		.cfi_offset 6, -24
 137              		.cfi_offset 7, -20
ARM GAS  /tmp/cc2SP10t.s 			page 7


 138              		.cfi_offset 8, -16
 139              		.cfi_offset 9, -12
 140              		.cfi_offset 10, -8
 141              		.cfi_offset 14, -4
 142 0004 92B0     		sub	sp, sp, #72
 143              	.LCFI2:
 144              		.cfi_def_cfa_offset 104
  83:../bootloader/Src/usb_endp.c **** 	
 145              		.loc 1 83 3 view .LVU26
 146 0006 0120     		movs	r0, #1
 147 0008 02A9     		add	r1, sp, #8
 148 000a FFF7FEFF 		bl	USB_SIL_Read
 149              	.LVL6:
  85:../bootloader/Src/usb_endp.c **** 	
 150              		.loc 1 85 2 is_stmt 1 view .LVU27
  87:../bootloader/Src/usb_endp.c **** 	switch (repotId)
 151              		.loc 1 87 2 is_stmt 0 view .LVU28
 152 000e 4FF40052 		mov	r2, #8192
  85:../bootloader/Src/usb_endp.c **** 	
 153              		.loc 1 85 10 view .LVU29
 154 0012 9DF80830 		ldrb	r3, [sp, #8]	@ zero_extendqisi2
 155              	.LVL7:
  87:../bootloader/Src/usb_endp.c **** 	switch (repotId)
 156              		.loc 1 87 2 is_stmt 1 view .LVU30
 157 0016 584E     		ldr	r6, .L38
  88:../bootloader/Src/usb_endp.c **** 	{		
 158              		.loc 1 88 2 is_stmt 0 view .LVU31
 159 0018 042B     		cmp	r3, #4
  87:../bootloader/Src/usb_endp.c **** 	switch (repotId)
 160              		.loc 1 87 2 view .LVU32
 161 001a 7261     		str	r2, [r6, #20]
  88:../bootloader/Src/usb_endp.c **** 	{		
 162              		.loc 1 88 2 is_stmt 1 view .LVU33
 163 001c 62D1     		bne	.L12
 164              	.LBB2:
  92:../bootloader/Src/usb_endp.c **** 			uint16_t firmware_in_cnt = 0;
 165              		.loc 1 92 4 view .LVU34
 166              	.LVL8:
  93:../bootloader/Src/usb_endp.c **** 			
 167              		.loc 1 93 4 view .LVU35
  95:../bootloader/Src/usb_endp.c **** 			
 168              		.loc 1 95 4 view .LVU36
  95:../bootloader/Src/usb_endp.c **** 			
 169              		.loc 1 95 26 is_stmt 0 view .LVU37
 170 001e 9DF80930 		ldrb	r3, [sp, #9]	@ zero_extendqisi2
 171              	.LVL9:
  95:../bootloader/Src/usb_endp.c **** 			
 172              		.loc 1 95 42 view .LVU38
 173 0022 9DF80A40 		ldrb	r4, [sp, #10]	@ zero_extendqisi2
 174              	.LVL10:
  97:../bootloader/Src/usb_endp.c **** 			{
 175              		.loc 1 97 4 is_stmt 1 view .LVU39
  97:../bootloader/Src/usb_endp.c **** 			{
 176              		.loc 1 97 7 is_stmt 0 view .LVU40
 177 0026 54EA0324 		orrs	r4, r4, r3, lsl #8
 178              	.LVL11:
  97:../bootloader/Src/usb_endp.c **** 			{
ARM GAS  /tmp/cc2SP10t.s 			page 8


 179              		.loc 1 97 7 view .LVU41
 180 002a 32D1     		bne	.L13
  99:../bootloader/Src/usb_endp.c **** 				crc_in = hid_buf[7]<<8 | hid_buf[6];
 181              		.loc 1 99 5 is_stmt 1 view .LVU42
  99:../bootloader/Src/usb_endp.c **** 				crc_in = hid_buf[7]<<8 | hid_buf[6];
 182              		.loc 1 99 27 is_stmt 0 view .LVU43
 183 002c 9DF80D20 		ldrb	r2, [sp, #13]	@ zero_extendqisi2
  99:../bootloader/Src/usb_endp.c **** 				crc_in = hid_buf[7]<<8 | hid_buf[6];
 184              		.loc 1 99 43 view .LVU44
 185 0030 9DF80C30 		ldrb	r3, [sp, #12]	@ zero_extendqisi2
 100:../bootloader/Src/usb_endp.c **** 				
 186              		.loc 1 100 21 view .LVU45
 187 0034 9DF80F10 		ldrb	r1, [sp, #15]	@ zero_extendqisi2
  99:../bootloader/Src/usb_endp.c **** 				crc_in = hid_buf[7]<<8 | hid_buf[6];
 188              		.loc 1 99 34 view .LVU46
 189 0038 43EA0223 		orr	r3, r3, r2, lsl #8
  99:../bootloader/Src/usb_endp.c **** 				crc_in = hid_buf[7]<<8 | hid_buf[6];
 190              		.loc 1 99 18 view .LVU47
 191 003c 4F4A     		ldr	r2, .L38+4
 102:../bootloader/Src/usb_endp.c **** 				{
 192              		.loc 1 102 8 view .LVU48
 193 003e B3F5604F 		cmp	r3, #57344
  99:../bootloader/Src/usb_endp.c **** 				crc_in = hid_buf[7]<<8 | hid_buf[6];
 194              		.loc 1 99 18 view .LVU49
 195 0042 1380     		strh	r3, [r2]	@ movhi
 100:../bootloader/Src/usb_endp.c **** 				
 196              		.loc 1 100 5 is_stmt 1 view .LVU50
 100:../bootloader/Src/usb_endp.c **** 				
 197              		.loc 1 100 37 is_stmt 0 view .LVU51
 198 0044 9DF80E20 		ldrb	r2, [sp, #14]	@ zero_extendqisi2
 100:../bootloader/Src/usb_endp.c **** 				
 199              		.loc 1 100 28 view .LVU52
 200 0048 42EA0122 		orr	r2, r2, r1, lsl #8
 100:../bootloader/Src/usb_endp.c **** 				
 201              		.loc 1 100 12 view .LVU53
 202 004c 4C49     		ldr	r1, .L38+8
 203 004e 0A80     		strh	r2, [r1]	@ movhi
 102:../bootloader/Src/usb_endp.c **** 				{
 204              		.loc 1 102 5 is_stmt 1 view .LVU54
 102:../bootloader/Src/usb_endp.c **** 				{
 205              		.loc 1 102 8 is_stmt 0 view .LVU55
 206 0050 00F28B80 		bhi	.L20
 104:../bootloader/Src/usb_endp.c **** 					
 207              		.loc 1 104 6 is_stmt 1 view .LVU56
 104:../bootloader/Src/usb_endp.c **** 					
 208              		.loc 1 104 20 is_stmt 0 view .LVU57
 209 0054 0122     		movs	r2, #1
 210 0056 4B4B     		ldr	r3, .L38+12
 106:../bootloader/Src/usb_endp.c **** 					for (uint8_t i=0; i<MAX_PAGE-FIRMWARE_START_PAGE; i++)
 211              		.loc 1 106 6 view .LVU58
 212 0058 4B4C     		ldr	r4, .L38+16
 213              	.LVL12:
 104:../bootloader/Src/usb_endp.c **** 					
 214              		.loc 1 104 20 view .LVU59
 215 005a 1A70     		strb	r2, [r3]
 106:../bootloader/Src/usb_endp.c **** 					for (uint8_t i=0; i<MAX_PAGE-FIRMWARE_START_PAGE; i++)
 216              		.loc 1 106 6 is_stmt 1 view .LVU60
ARM GAS  /tmp/cc2SP10t.s 			page 9


 217 005c FFF7FEFF 		bl	FLASH_Unlock
 218              	.LVL13:
 107:../bootloader/Src/usb_endp.c **** 					{
 219              		.loc 1 107 6 view .LVU61
 220              	.LBB3:
 107:../bootloader/Src/usb_endp.c **** 					{
 221              		.loc 1 107 11 view .LVU62
 107:../bootloader/Src/usb_endp.c **** 					{
 222              		.loc 1 107 24 view .LVU63
 107:../bootloader/Src/usb_endp.c **** 					{
 223              		.loc 1 107 6 is_stmt 0 view .LVU64
 224 0060 4A4D     		ldr	r5, .L38+20
 225              	.LVL14:
 226              	.L15:
 109:../bootloader/Src/usb_endp.c **** 						{
 227              		.loc 1 109 7 is_stmt 1 view .LVU65
 109:../bootloader/Src/usb_endp.c **** 						{
 228              		.loc 1 109 11 is_stmt 0 view .LVU66
 229 0062 2046     		mov	r0, r4
 230 0064 04F58064 		add	r4, r4, #1024
 231 0068 FFF7FEFF 		bl	FLASH_ErasePage
 232              	.LVL15:
 107:../bootloader/Src/usb_endp.c **** 					{
 233              		.loc 1 107 56 is_stmt 1 view .LVU67
 107:../bootloader/Src/usb_endp.c **** 					{
 234              		.loc 1 107 24 view .LVU68
 107:../bootloader/Src/usb_endp.c **** 					{
 235              		.loc 1 107 6 is_stmt 0 view .LVU69
 236 006c AC42     		cmp	r4, r5
 237 006e F8D1     		bne	.L15
 238              	.LBE3:
 114:../bootloader/Src/usb_endp.c **** 					firmware_in_cnt = cnt+1;
 239              		.loc 1 114 6 is_stmt 1 view .LVU70
 240 0070 FFF7FEFF 		bl	FLASH_Lock
 241              	.LVL16:
 115:../bootloader/Src/usb_endp.c **** 				}
 242              		.loc 1 115 6 view .LVU71
 157:../bootloader/Src/usb_endp.c **** 			{
 243              		.loc 1 157 4 view .LVU72
 115:../bootloader/Src/usb_endp.c **** 				}
 244              		.loc 1 115 22 is_stmt 0 view .LVU73
 245 0074 0123     		movs	r3, #1
 246              	.LVL17:
 247              	.L14:
 248              	.LBB4:
 159:../bootloader/Src/usb_endp.c **** 				tmp_buf[0] = REPORT_ID_FIRMWARE;
 249              		.loc 1 159 5 is_stmt 1 view .LVU74
 160:../bootloader/Src/usb_endp.c **** 				tmp_buf[1] = (firmware_in_cnt)>>8;
 250              		.loc 1 160 5 view .LVU75
 160:../bootloader/Src/usb_endp.c **** 				tmp_buf[1] = (firmware_in_cnt)>>8;
 251              		.loc 1 160 16 is_stmt 0 view .LVU76
 252 0076 0422     		movs	r2, #4
 253 0078 8DF80420 		strb	r2, [sp, #4]
 161:../bootloader/Src/usb_endp.c **** 				tmp_buf[2] = (firmware_in_cnt)&0xFF;
 254              		.loc 1 161 5 is_stmt 1 view .LVU77
 161:../bootloader/Src/usb_endp.c **** 				tmp_buf[2] = (firmware_in_cnt)&0xFF;
 255              		.loc 1 161 16 is_stmt 0 view .LVU78
ARM GAS  /tmp/cc2SP10t.s 			page 10


 256 007c 1A0A     		lsrs	r2, r3, #8
 257 007e 8DF80520 		strb	r2, [sp, #5]
 162:../bootloader/Src/usb_endp.c **** 				
 258              		.loc 1 162 5 is_stmt 1 view .LVU79
 164:../bootloader/Src/usb_endp.c **** 
 259              		.loc 1 164 5 is_stmt 0 view .LVU80
 260 0082 01A9     		add	r1, sp, #4
 261 0084 0322     		movs	r2, #3
 262 0086 0120     		movs	r0, #1
 162:../bootloader/Src/usb_endp.c **** 				
 263              		.loc 1 162 16 view .LVU81
 264 0088 8DF80630 		strb	r3, [sp, #6]
 164:../bootloader/Src/usb_endp.c **** 
 265              		.loc 1 164 5 is_stmt 1 view .LVU82
 266 008c FFF7FEFF 		bl	USB_CUSTOM_HID_SendReport
 267              	.LVL18:
 268 0090 28E0     		b	.L12
 269              	.LVL19:
 270              	.L13:
 164:../bootloader/Src/usb_endp.c **** 
 271              		.loc 1 164 5 is_stmt 0 view .LVU83
 272              	.LBE4:
 122:../bootloader/Src/usb_endp.c **** 			{
 273              		.loc 1 122 9 is_stmt 1 view .LVU84
 122:../bootloader/Src/usb_endp.c **** 			{
 274              		.loc 1 122 13 is_stmt 0 view .LVU85
 275 0092 3C4B     		ldr	r3, .L38+12
 276 0094 1A78     		ldrb	r2, [r3]	@ zero_extendqisi2
 277 0096 9846     		mov	r8, r3
 122:../bootloader/Src/usb_endp.c **** 			{
 278              		.loc 1 122 12 view .LVU86
 279 0098 7AB3     		cbz	r2, .L16
 122:../bootloader/Src/usb_endp.c **** 			{
 280              		.loc 1 122 44 discriminator 1 view .LVU87
 281 009a 384B     		ldr	r3, .L38+4
 282 009c 1B88     		ldrh	r3, [r3]
 122:../bootloader/Src/usb_endp.c **** 			{
 283              		.loc 1 122 27 discriminator 1 view .LVU88
 284 009e 63B3     		cbz	r3, .L16
 122:../bootloader/Src/usb_endp.c **** 			{
 285              		.loc 1 122 56 discriminator 2 view .LVU89
 286 00a0 3C25     		movs	r5, #60
 287 00a2 6543     		muls	r5, r4, r5
 122:../bootloader/Src/usb_endp.c **** 			{
 288              		.loc 1 122 49 discriminator 2 view .LVU90
 289 00a4 9D42     		cmp	r5, r3
 290 00a6 28DA     		bge	.L16
 124:../bootloader/Src/usb_endp.c **** 				for (uint8_t i=0;i<60;i+=2)
 291              		.loc 1 124 5 is_stmt 1 view .LVU91
 292 00a8 FFF7FEFF 		bl	FLASH_Unlock
 293              	.LVL20:
 125:../bootloader/Src/usb_endp.c **** 				{
 294              		.loc 1 125 5 view .LVU92
 295              	.LBB5:
 125:../bootloader/Src/usb_endp.c **** 				{
 296              		.loc 1 125 10 view .LVU93
 125:../bootloader/Src/usb_endp.c **** 				{
ARM GAS  /tmp/cc2SP10t.s 			page 11


 297              		.loc 1 125 22 view .LVU94
 298              	.LBB6:
 128:../bootloader/Src/usb_endp.c **** 				}
 299              		.loc 1 128 47 is_stmt 0 view .LVU95
 300 00ac 384F     		ldr	r7, .L38+24
 301 00ae 0DF10808 		add	r8, sp, #8
 302 00b2 2F44     		add	r7, r7, r5
 303 00b4 05F10065 		add	r5, r5, #134217728
 304 00b8 05F50055 		add	r5, r5, #8192
 305              	.LVL21:
 306              	.L17:
 127:../bootloader/Src/usb_endp.c **** 					FLASH_ProgramHalfWord(FIRMWARE_COPY_ADDR + (cnt-1)*60 + i, tmp16);
 307              		.loc 1 127 6 is_stmt 1 discriminator 3 view .LVU96
 128:../bootloader/Src/usb_endp.c **** 				}
 308              		.loc 1 128 6 discriminator 3 view .LVU97
 127:../bootloader/Src/usb_endp.c **** 					FLASH_ProgramHalfWord(FIRMWARE_COPY_ADDR + (cnt-1)*60 + i, tmp16);
 309              		.loc 1 127 30 is_stmt 0 discriminator 3 view .LVU98
 310 00bc 98F80510 		ldrb	r1, [r8, #5]	@ zero_extendqisi2
 127:../bootloader/Src/usb_endp.c **** 					FLASH_ProgramHalfWord(FIRMWARE_COPY_ADDR + (cnt-1)*60 + i, tmp16);
 311              		.loc 1 127 50 discriminator 3 view .LVU99
 312 00c0 98F80430 		ldrb	r3, [r8, #4]	@ zero_extendqisi2
 128:../bootloader/Src/usb_endp.c **** 				}
 313              		.loc 1 128 6 discriminator 3 view .LVU100
 314 00c4 3846     		mov	r0, r7
 315 00c6 43EA0121 		orr	r1, r3, r1, lsl #8
 316 00ca 0237     		adds	r7, r7, #2
 317 00cc FFF7FEFF 		bl	FLASH_ProgramHalfWord
 318              	.LVL22:
 128:../bootloader/Src/usb_endp.c **** 				}
 319              		.loc 1 128 6 discriminator 3 view .LVU101
 320              	.LBE6:
 125:../bootloader/Src/usb_endp.c **** 				{
 321              		.loc 1 125 27 is_stmt 1 discriminator 3 view .LVU102
 125:../bootloader/Src/usb_endp.c **** 				{
 322              		.loc 1 125 22 discriminator 3 view .LVU103
 125:../bootloader/Src/usb_endp.c **** 				{
 323              		.loc 1 125 5 is_stmt 0 discriminator 3 view .LVU104
 324 00d0 BD42     		cmp	r5, r7
 325 00d2 08F10208 		add	r8, r8, #2
 326              	.LVL23:
 125:../bootloader/Src/usb_endp.c **** 				{
 327              		.loc 1 125 5 discriminator 3 view .LVU105
 328 00d6 F1D1     		bne	.L17
 329              	.LBE5:
 130:../bootloader/Src/usb_endp.c **** 				firmware_in_cnt = cnt+1;
 330              		.loc 1 130 5 is_stmt 1 view .LVU106
 331 00d8 FFF7FEFF 		bl	FLASH_Lock
 332              	.LVL24:
 131:../bootloader/Src/usb_endp.c **** 			}
 333              		.loc 1 131 5 view .LVU107
 131:../bootloader/Src/usb_endp.c **** 			}
 334              		.loc 1 131 21 is_stmt 0 view .LVU108
 335 00dc 631C     		adds	r3, r4, #1
 336 00de 9BB2     		uxth	r3, r3
 337              	.LVL25:
 157:../bootloader/Src/usb_endp.c **** 			{
 338              		.loc 1 157 4 is_stmt 1 view .LVU109
ARM GAS  /tmp/cc2SP10t.s 			page 12


 157:../bootloader/Src/usb_endp.c **** 			{
 339              		.loc 1 157 7 is_stmt 0 view .LVU110
 340 00e0 002B     		cmp	r3, #0
 341 00e2 C8D1     		bne	.L14
 342              	.LVL26:
 343              	.L12:
 157:../bootloader/Src/usb_endp.c **** 			{
 344              		.loc 1 157 7 view .LVU111
 345              	.LBE2:
 175:../bootloader/Src/usb_endp.c ****   SetEPRxStatus(ENDP1, EP_RX_VALID);
 346              		.loc 1 175 2 is_stmt 1 view .LVU112
 347 00e4 4FF40053 		mov	r3, #8192
 176:../bootloader/Src/usb_endp.c **** }
 348              		.loc 1 176 3 is_stmt 0 view .LVU113
 349 00e8 4FF44051 		mov	r1, #12288
 350 00ec 0120     		movs	r0, #1
 175:../bootloader/Src/usb_endp.c ****   SetEPRxStatus(ENDP1, EP_RX_VALID);
 351              		.loc 1 175 2 view .LVU114
 352 00ee 3361     		str	r3, [r6, #16]
 176:../bootloader/Src/usb_endp.c **** }
 353              		.loc 1 176 3 is_stmt 1 view .LVU115
 354 00f0 FFF7FEFF 		bl	SetEPRxStatus
 355              	.LVL27:
 177:../bootloader/Src/usb_endp.c **** 
 356              		.loc 1 177 1 is_stmt 0 view .LVU116
 357 00f4 12B0     		add	sp, sp, #72
 358              	.LCFI3:
 359              		.cfi_remember_state
 360              		.cfi_def_cfa_offset 32
 361              		@ sp needed
 362 00f6 BDE8F087 		pop	{r4, r5, r6, r7, r8, r9, r10, pc}
 363              	.LVL28:
 364              	.L16:
 365              	.LCFI4:
 366              		.cfi_restore_state
 367              	.LBB9:
 133:../bootloader/Src/usb_endp.c **** 			{
 368              		.loc 1 133 9 is_stmt 1 view .LVU117
 133:../bootloader/Src/usb_endp.c **** 			{
 369              		.loc 1 133 13 is_stmt 0 view .LVU118
 370 00fa 98F80030 		ldrb	r3, [r8]	@ zero_extendqisi2
 133:../bootloader/Src/usb_endp.c **** 			{
 371              		.loc 1 133 12 view .LVU119
 372 00fe 002B     		cmp	r3, #0
 373 0100 F0D0     		beq	.L12
 133:../bootloader/Src/usb_endp.c **** 			{
 374              		.loc 1 133 43 discriminator 1 view .LVU120
 375 0102 1E4B     		ldr	r3, .L38+4
 133:../bootloader/Src/usb_endp.c **** 			{
 376              		.loc 1 133 27 discriminator 1 view .LVU121
 377 0104 1A88     		ldrh	r2, [r3]
 378 0106 9946     		mov	r9, r3
 379 0108 002A     		cmp	r2, #0
 380 010a EBD0     		beq	.L12
 135:../bootloader/Src/usb_endp.c **** 				for (uint8_t i=0;i<60;i+=2)
 381              		.loc 1 135 5 is_stmt 1 view .LVU122
 382 010c FFF7FEFF 		bl	FLASH_Unlock
ARM GAS  /tmp/cc2SP10t.s 			page 13


 383              	.LVL29:
 136:../bootloader/Src/usb_endp.c **** 				{
 384              		.loc 1 136 5 view .LVU123
 385              	.LBB7:
 136:../bootloader/Src/usb_endp.c **** 				{
 386              		.loc 1 136 10 view .LVU124
 136:../bootloader/Src/usb_endp.c **** 				{
 387              		.loc 1 136 22 view .LVU125
 388              	.LBB8:
 139:../bootloader/Src/usb_endp.c **** 				}
 389              		.loc 1 139 56 is_stmt 0 view .LVU126
 390 0110 3C23     		movs	r3, #60
 139:../bootloader/Src/usb_endp.c **** 				}
 391              		.loc 1 139 53 view .LVU127
 392 0112 013C     		subs	r4, r4, #1
 393              	.LVL30:
 139:../bootloader/Src/usb_endp.c **** 				}
 394              		.loc 1 139 56 view .LVU128
 395 0114 5C43     		muls	r4, r3, r4
 396              	.LVL31:
 139:../bootloader/Src/usb_endp.c **** 				}
 397              		.loc 1 139 56 view .LVU129
 398 0116 DFF880A0 		ldr	r10, .L38+32
 139:../bootloader/Src/usb_endp.c **** 				}
 399              		.loc 1 139 47 view .LVU130
 400 011a 04F10067 		add	r7, r4, #134217728
 401 011e 02AD     		add	r5, sp, #8
 402 0120 07F50057 		add	r7, r7, #8192
 403 0124 A244     		add	r10, r10, r4
 404              	.LVL32:
 405              	.L19:
 138:../bootloader/Src/usb_endp.c **** 					FLASH_ProgramHalfWord(FIRMWARE_COPY_ADDR + (cnt-1)*60 + i, tmp16);
 406              		.loc 1 138 6 is_stmt 1 discriminator 3 view .LVU131
 139:../bootloader/Src/usb_endp.c **** 				}
 407              		.loc 1 139 6 discriminator 3 view .LVU132
 138:../bootloader/Src/usb_endp.c **** 					FLASH_ProgramHalfWord(FIRMWARE_COPY_ADDR + (cnt-1)*60 + i, tmp16);
 408              		.loc 1 138 30 is_stmt 0 discriminator 3 view .LVU133
 409 0126 6979     		ldrb	r1, [r5, #5]	@ zero_extendqisi2
 138:../bootloader/Src/usb_endp.c **** 					FLASH_ProgramHalfWord(FIRMWARE_COPY_ADDR + (cnt-1)*60 + i, tmp16);
 410              		.loc 1 138 50 discriminator 3 view .LVU134
 411 0128 2B79     		ldrb	r3, [r5, #4]	@ zero_extendqisi2
 139:../bootloader/Src/usb_endp.c **** 				}
 412              		.loc 1 139 6 discriminator 3 view .LVU135
 413 012a 3846     		mov	r0, r7
 414 012c 43EA0121 		orr	r1, r3, r1, lsl #8
 415 0130 0237     		adds	r7, r7, #2
 416 0132 FFF7FEFF 		bl	FLASH_ProgramHalfWord
 417              	.LVL33:
 139:../bootloader/Src/usb_endp.c **** 				}
 418              		.loc 1 139 6 discriminator 3 view .LVU136
 419              	.LBE8:
 136:../bootloader/Src/usb_endp.c **** 				{
 420              		.loc 1 136 27 is_stmt 1 discriminator 3 view .LVU137
 136:../bootloader/Src/usb_endp.c **** 				{
 421              		.loc 1 136 22 discriminator 3 view .LVU138
 136:../bootloader/Src/usb_endp.c **** 				{
 422              		.loc 1 136 5 is_stmt 0 discriminator 3 view .LVU139
ARM GAS  /tmp/cc2SP10t.s 			page 14


 423 0136 BA45     		cmp	r10, r7
 424 0138 05F10205 		add	r5, r5, #2
 425              	.LVL34:
 136:../bootloader/Src/usb_endp.c **** 				{
 426              		.loc 1 136 5 discriminator 3 view .LVU140
 427 013c F3D1     		bne	.L19
 428              	.LBE7:
 141:../bootloader/Src/usb_endp.c **** 				
 429              		.loc 1 141 5 is_stmt 1 view .LVU141
 430 013e FFF7FEFF 		bl	FLASH_Lock
 431              	.LVL35:
 144:../bootloader/Src/usb_endp.c **** 				if (crc_in == crc_comp && crc_comp != 0)
 432              		.loc 1 144 5 view .LVU142
 144:../bootloader/Src/usb_endp.c **** 				if (crc_in == crc_comp && crc_comp != 0)
 433              		.loc 1 144 16 is_stmt 0 view .LVU143
 434 0142 B9F80010 		ldrh	r1, [r9]
 435 0146 1048     		ldr	r0, .L38+16
 436 0148 FFF7FEFF 		bl	Crc16
 437              	.LVL36:
 145:../bootloader/Src/usb_endp.c **** 				{
 438              		.loc 1 145 5 is_stmt 1 view .LVU144
 145:../bootloader/Src/usb_endp.c **** 				{
 439              		.loc 1 145 16 is_stmt 0 view .LVU145
 440 014c 0C4B     		ldr	r3, .L38+8
 441 014e 1B88     		ldrh	r3, [r3]
 442 0150 9BB2     		uxth	r3, r3
 145:../bootloader/Src/usb_endp.c **** 				{
 443              		.loc 1 145 8 view .LVU146
 444 0152 8342     		cmp	r3, r0
 445 0154 0CD1     		bne	.L22
 145:../bootloader/Src/usb_endp.c **** 				{
 446              		.loc 1 145 28 discriminator 1 view .LVU147
 447 0156 5BB1     		cbz	r3, .L22
 147:../bootloader/Src/usb_endp.c **** 					flash_finished = 1;
 448              		.loc 1 147 6 is_stmt 1 view .LVU148
 147:../bootloader/Src/usb_endp.c **** 					flash_finished = 1;
 449              		.loc 1 147 20 is_stmt 0 view .LVU149
 450 0158 0023     		movs	r3, #0
 148:../bootloader/Src/usb_endp.c **** 					firmware_in_cnt = 0xF000;	// OK
 451              		.loc 1 148 21 view .LVU150
 452 015a 0122     		movs	r2, #1
 147:../bootloader/Src/usb_endp.c **** 					flash_finished = 1;
 453              		.loc 1 147 20 view .LVU151
 454 015c 88F80030 		strb	r3, [r8]
 148:../bootloader/Src/usb_endp.c **** 					firmware_in_cnt = 0xF000;	// OK
 455              		.loc 1 148 6 is_stmt 1 view .LVU152
 148:../bootloader/Src/usb_endp.c **** 					firmware_in_cnt = 0xF000;	// OK
 456              		.loc 1 148 21 is_stmt 0 view .LVU153
 457 0160 0C4B     		ldr	r3, .L38+28
 458 0162 1A70     		strb	r2, [r3]
 149:../bootloader/Src/usb_endp.c **** 				}
 459              		.loc 1 149 6 is_stmt 1 view .LVU154
 460              	.LVL37:
 157:../bootloader/Src/usb_endp.c **** 			{
 461              		.loc 1 157 4 view .LVU155
 149:../bootloader/Src/usb_endp.c **** 				}
 462              		.loc 1 149 22 is_stmt 0 view .LVU156
ARM GAS  /tmp/cc2SP10t.s 			page 15


 463 0164 4FF47043 		mov	r3, #61440
 464 0168 85E7     		b	.L14
 465              	.LVL38:
 466              	.L20:
 119:../bootloader/Src/usb_endp.c **** 				}
 467              		.loc 1 119 22 view .LVU157
 468 016a 4FF20103 		movw	r3, #61441
 469 016e 82E7     		b	.L14
 470              	.LVL39:
 471              	.L22:
 153:../bootloader/Src/usb_endp.c **** 				}
 472              		.loc 1 153 22 view .LVU158
 473 0170 4FF20203 		movw	r3, #61442
 474 0174 7FE7     		b	.L14
 475              	.L39:
 476 0176 00BF     		.align	2
 477              	.L38:
 478 0178 00100140 		.word	1073811456
 479 017c 00000000 		.word	.LANCHOR1
 480 0180 00000000 		.word	.LANCHOR2
 481 0184 00000000 		.word	.LANCHOR3
 482 0188 00200008 		.word	134225920
 483 018c 00000108 		.word	134283264
 484 0190 C41F0008 		.word	134225860
 485 0194 00000000 		.word	.LANCHOR4
 486 0198 3C200008 		.word	134225980
 487              	.LBE9:
 488              		.cfi_endproc
 489              	.LFE29:
 491              		.global	flash_finished
 492              		.global	flash_started
 493              		.global	EP1_PrevXferComplete
 494              		.section	.bss.crc_in,"aw",%nobits
 495              		.align	1
 496              		.set	.LANCHOR2,. + 0
 499              	crc_in:
 500 0000 0000     		.space	2
 501              		.section	.bss.firmware_len.5477,"aw",%nobits
 502              		.align	1
 503              		.set	.LANCHOR1,. + 0
 506              	firmware_len.5477:
 507 0000 0000     		.space	2
 508              		.section	.bss.flash_finished,"aw",%nobits
 509              		.set	.LANCHOR4,. + 0
 512              	flash_finished:
 513 0000 00       		.space	1
 514              		.section	.bss.flash_started,"aw",%nobits
 515              		.set	.LANCHOR3,. + 0
 518              	flash_started:
 519 0000 00       		.space	1
 520              		.section	.data.EP1_PrevXferComplete,"aw"
 521              		.set	.LANCHOR0,. + 0
 524              	EP1_PrevXferComplete:
 525 0000 01       		.byte	1
 526              		.text
 527              	.Letext0:
 528              		.file 2 "/usr/lib/gcc/arm-none-eabi/9.2.1/include/stdint.h"
ARM GAS  /tmp/cc2SP10t.s 			page 16


 529              		.file 3 "../Drivers/CMSIS/CM3/CoreSupport/core_cm3.h"
 530              		.file 4 "../Drivers/CMSIS/CM3/DeviceSupport/ST/STM32F10x/system_stm32f10x.h"
 531              		.file 5 "../Drivers/CMSIS/CM3/DeviceSupport/ST/STM32F10x/stm32f10x.h"
 532              		.file 6 "../bootloader/Inc/periphery.h"
 533              		.file 7 "../Drivers/STM32_USB-FS-Device_Driver/inc/usb_type.h"
 534              		.file 8 "../bootloader/Inc/usb_hw.h"
 535              		.file 9 "../Drivers/STM32_USB-FS-Device_Driver/inc/usb_regs.h"
 536              		.file 10 "../Drivers/STM32_USB-FS-Device_Driver/inc/usb_core.h"
 537              		.file 11 "../Drivers/STM32_USB-FS-Device_Driver/inc/usb_init.h"
 538              		.file 12 "../Drivers/STM32_USB-FS-Device_Driver/inc/usb_lib.h"
 539              		.file 13 "../bootloader/Inc/usb_pwr.h"
 540              		.file 14 "../Drivers/STM32_USB-FS-Device_Driver/inc/usb_sil.h"
 541              		.file 15 "../utils/crc16.h"
ARM GAS  /tmp/cc2SP10t.s 			page 17


DEFINED SYMBOLS
                            *ABS*:0000000000000000 usb_endp.c
     /tmp/cc2SP10t.s:16     .text.EP1_IN_Callback:0000000000000000 $t
     /tmp/cc2SP10t.s:24     .text.EP1_IN_Callback:0000000000000000 EP1_IN_Callback
     /tmp/cc2SP10t.s:42     .text.EP1_IN_Callback:0000000000000008 $d
     /tmp/cc2SP10t.s:47     .text.USB_CUSTOM_HID_SendReport:0000000000000000 $t
     /tmp/cc2SP10t.s:54     .text.USB_CUSTOM_HID_SendReport:0000000000000000 USB_CUSTOM_HID_SendReport
     /tmp/cc2SP10t.s:107    .text.USB_CUSTOM_HID_SendReport:0000000000000028 $d
     /tmp/cc2SP10t.s:113    .text.EP1_OUT_Callback:0000000000000000 $t
     /tmp/cc2SP10t.s:120    .text.EP1_OUT_Callback:0000000000000000 EP1_OUT_Callback
     /tmp/cc2SP10t.s:478    .text.EP1_OUT_Callback:0000000000000178 $d
     /tmp/cc2SP10t.s:512    .bss.flash_finished:0000000000000000 flash_finished
     /tmp/cc2SP10t.s:518    .bss.flash_started:0000000000000000 flash_started
     /tmp/cc2SP10t.s:524    .data.EP1_PrevXferComplete:0000000000000000 EP1_PrevXferComplete
     /tmp/cc2SP10t.s:495    .bss.crc_in:0000000000000000 $d
     /tmp/cc2SP10t.s:499    .bss.crc_in:0000000000000000 crc_in
     /tmp/cc2SP10t.s:502    .bss.firmware_len.5477:0000000000000000 $d
     /tmp/cc2SP10t.s:506    .bss.firmware_len.5477:0000000000000000 firmware_len.5477
     /tmp/cc2SP10t.s:513    .bss.flash_finished:0000000000000000 $d
     /tmp/cc2SP10t.s:519    .bss.flash_started:0000000000000000 $d

UNDEFINED SYMBOLS
USB_SIL_Write
SetEPTxValid
bDeviceState
USB_SIL_Read
FLASH_Unlock
FLASH_ErasePage
FLASH_Lock
FLASH_ProgramHalfWord
SetEPRxStatus
Crc16
